<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <button onclick="showResult()">CLICK ME</button>
    <div id="result"></div>
</body>
</html>


<script>
  let result = document.getElementById("result");

  async function fetchUrl(url) {
      let text = await fetch(url);
      await console.log(text);
      await console.log(typeof(text));
      result.innerHTML = await text;
  };
  function showResult(){
      console.log("Clicked");
      fetchUrl("https://www.google.com/search?q=font+montserrat&rlz=1C5CHFA_enJP913JP914&sxsrf=ALeKk01JLSFcll1HZIcykOJx242YFLEZ9A%3A1625401494212&ei=lqjhYK6zDPuJr7wPxYeG8AY&oq=font+montserrat&gs_lcp=Cgdnd3Mtd2l6EAMyAggAMgUIABDLATIFCAAQywEyBQgAEMsBMgUIABDLATIFCAAQywEyBQgAEMsBMgUIABDLAToHCAAQsQMQQzoKCAAQsQMQgwEQQzoICAAQsQMQgwE6BAgAEEM6BQgAELEDOgQIABAEOgcIABAKEMsBOgQIABAeSgQIQRgAULSBLljQuS5g77suaAFwAHgBgAH9B4gByS2SAQ0yLTUuMi4xLjMuMS4xmAEAoAEBqgEHZ3dzLXdpesABAQ&sclient=gws-wiz&ved=0ahUKEwiu1re1tMnxAhX7xIsBHcWDAW4Q4dUDCA4&uact=5");
  }



  const divs = document.getElementsByTagName("div");
  let base_url = "https://drive.google.com/file/d/";
  let suffix = "/view?usp=sharing";

  let pdfInfos = [];
  let info = {};
  for (let i = 0; i < divs.length; i++) {
    let div = divs[i];
    // 必要な情報を含んでいるであろう、divの親を取得
    if (div.hasAttribute("data-id")) {
      const inner_divs = div.getElementsByTagName("div");
      const inner_spans = div.getElementsByTagName("span");
      info = {};
      info["url"] = base_url + div.getAttribute("data-id") + suffix;
      // pdfの名前の取得
      for (let i = 0; i < inner_divs.length; i++) {
        const inner_div = inner_divs[i];
        if (isPdfName(inner_div.innerHTML)){
          info["name"] = inner_div.textContent;
          pdfInfos.push(info);
          break
        }
      }
      // 最終更新日時の取得
      for (let i = 0; i < inner_spans.length; i++) {
        const inner_span = inner_spans[i];
        const {hasUA, updated_at} = getUpdatedAt(inner_span);
        if (hasUA) {
          info["updated_at"] = updated_at;
          break
        }
      }
    }
  }
  console.log(pdfInfos);
  function isPdfName(content) {
    return content.slice(-4) === ".pdf"
  }
  function getUpdatedAt(elm) {
    let has_updated_at = elm.hasAttribute("data-tooltip")
    && (elm.getAttribute("data-tooltip").slice(0,4) === "最終更新");
    let updated_at = "";
    if (has_updated_at) {
      let split_date = elm.getAttribute("data-tooltip").split(":");
      if (split_date.length === 2) {
        // "最終更新 : 07/03" みたいな場合
        updated_at = split_date[1].trim()
      } else {
        // "最終更新 : 20:03" みたいな場合
        updated_at = split_date.slice(1).join(":").trim();
      }
    }
    return {
      hasUA: has_updated_at,
      updated_at: updated_at
    }
  }

</script>
